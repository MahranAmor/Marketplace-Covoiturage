<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mes Trajets - Covoiturage</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #87CEEB 0%, #ffffff 100%);
            min-height: 100vh;
        }

        .header {
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: #667eea;
            text-decoration: none;
            cursor: pointer;
        }

        .nav-menu {
            display: flex;
            gap: 2rem;
            list-style: none;
        }

        .nav-menu a {
            text-decoration: none;
            color: #333;
            font-weight: 500;
            transition: color 0.3s;
        }

        .nav-menu a:hover,
        .nav-menu a.active {
            color: #667eea;
        }

        .auth-buttons {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .btn {
            padding: 0.6rem 1.5rem;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: transparent;
            color: #667eea;
            border: 2px solid #667eea;
        }

        .btn-secondary:hover {
            background: #87CEEB;
            color: white;
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
        }

        .btn-danger:hover {
            background: #c0392b;
        }

        .btn-small {
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
        }

        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 20px;
        }

        .page-header {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }

        .page-header h1 {
            color: #333;
            margin-bottom: 0.5rem;
        }

        .page-header p {
            color: #666;
        }

        .tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            background: white;
            padding: 1rem;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .tab {
            flex: 1;
            padding: 1rem;
            border: none;
            background: transparent;
            color: #666;
            font-weight: 500;
            cursor: pointer;
            border-radius: 10px;
            transition: all 0.3s;
        }

        .tab.active {
            background: #667eea;
            color: white;
        }

        .tab:hover {
            background: #f0f0f0;
        }

        .tab.active:hover {
            background: #5568d3;
        }

        .trajets-grid {
            display: grid;
            gap: 1.5rem;
        }

        .trajet-card {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            transition: all 0.3s;
        }

        .trajet-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .trajet-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #f0f0f0;
        }

        .trajet-route {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .location {
            font-weight: bold;
            color: #333;
            font-size: 1.2rem;
        }

        .arrow {
            color: #667eea;
            font-size: 1.5rem;
        }

        .trajet-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }

        .detail-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #666;
        }

        .icon {
            color: #667eea;
        }

        .trajet-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 2px solid #f0f0f0;
        }

        .badge {
            display: inline-block;
            padding: 0.3rem 0.8rem;
            border-radius: 15px;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .badge-success {
            background: #d4edda;
            color: #155724;
        }

        .badge-warning {
            background: #fff3cd;
            color: #856404;
        }

        .badge-info {
            background: #d1ecf1;
            color: #0c5460;
        }

        .badge-secondary {
            background: #e2e3e5;
            color: #383d41;
        }

        .empty-state {
            background: white;
            padding: 3rem;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
        }

        .empty-state h3 {
            color: #333;
            margin-bottom: 0.5rem;
        }

        .empty-state p {
            color: #666;
            margin-bottom: 1.5rem;
        }

        .reservations-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 2px solid #f0f0f0;
        }

        .reservation-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.8rem;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .reservation-info {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .footer {
            background: white;
            margin-top: 4rem;
            padding: 2rem 0;
            text-align: center;
            color: #666;
        }

        @media (max-width: 768px) {
            .nav-menu {
                display: none;
            }

            .tabs {
                flex-direction: column;
            }

            .trajet-details {
                grid-template-columns: 1fr;
            }

            .trajet-actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
<!-- ‚úÖ HEADER -->
<header class="header">
        <div class="nav-container">
            <!-- Logo cliquable -->
            <div class="logo" onclick="window.location.href='index.html'">üöó CovoitPlus</div>

            <!-- Menu de navigation -->
            <nav>
                <ul class="nav-menu">
                    <li><a href="/exsepareoffre/index_one.html">Accueil</a></li>
                    <li><a href="/exsepareoffre/Trajets.html">Trajets</a></li>
                    <li><a href="/exsepareoffre/publier.html">Publier un trajet</a></li>
                    <li><a href="/exsepareoffre/mesTrajets.html">Mes trajets</a></li>
                    <li id="adminMenuItem" style="display:none;"><a href="/exsepareoffre/admin_dashboard.html">Admin</a></li>
                </ul>
            </nav>

            <!-- Authentification et Panier -->
            <div class="auth-buttons">
                <div class="panier-icon" onclick="showPanier()">
                    <i class="fa-solid fa-cart-shopping"></i>
                    <span class="panier-count" id="panierCount">0</span>
                </div>
                <button class="btn btn-secondary" onclick="showModal('login')">Connexion</button>
                <button class="btn btn-primary" onclick="showModal('register')">Inscription</button>
            </div>
        </div>
    </header>


    <!-- Page Content -->
    <div class="container">
        <div class="page-header">
            <h1>Mes Trajets</h1>
            <p>G√©rez vos trajets publi√©s et vos r√©servations</p>
        </div>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab active" onclick="switchTab('publies')">
                Trajets publi√©s
            </button>
            <button class="tab" onclick="switchTab('reservations')">
                Mes r√©servations
            </button>
        </div>

        <!-- Trajets publi√©s -->
        <div id="trajetsPublies" class="trajets-grid">
            <!-- Contenu g√©n√©r√© par JavaScript -->
        </div>

        <!-- R√©servations -->
        <div id="mesReservations" class="trajets-grid" style="display: none;">
            <!-- Contenu g√©n√©r√© par JavaScript -->
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <p>&copy; 2025 CovoitPlus - Tous droits r√©serv√©s</p>
    </footer>

    <script>
        // Donn√©es simul√©es
        let trajetsPublies = [
            {
                id: 1,
                depart: "Tunis",
                arrivee: "Sousse",
                date: "2025-10-20",
                heure: "09:00",
                places: 3,
                placesInitiales: 3,
                prix: 15,
                statut: "actif",
                reservations: []
            },
            {
                id: 2,
                depart: "Sfax",
                arrivee: "Tunis",
                date: "2025-10-25",
                heure: "14:00",
                places: 1,
                placesInitiales: 4,
                prix: 25,
                statut: "actif",
                reservations: [
                    { nom: "Ahmed Ben Ali", places: 2, telephone: "12345678" },
                    { nom: "Sara Mansour", places: 1, telephone: "87654321" }
                ]
            },
            {
                id: 3,
                depart: "Monastir",
                arrivee: "Hammamet",
                date: "2025-10-10",
                heure: "10:30",
                places: 0,
                placesInitiales: 2,
                prix: 12,
                statut: "termine",
                reservations: [
                    { nom: "Karim Zaouali", places: 2, telephone: "55443322" }
                ]
            }
        ];

        let mesReservationsData = [
            {
                id: 1,
                depart: "Sfax",
                arrivee: "Monastir",
                date: "2025-10-15",
                heure: "08:00",
                places: 2,
                prix: 15,
                conducteur: "Salah Merghi",
                telephone: "20123456",
                statut: "confirmee"
            },
            {
                id: 2,
                depart: "Qabes",
                arrivee: "Medenine",
                date: "2025-10-17",
                heure: "10:00",
                places: 1,
                prix: 20,
                conducteur: "Monem Guesmi",
                telephone: "22334455",
                statut: "confirmee"
            },
            {
                id: 3,
                depart: "Tunis",
                arrivee: "Bizerte",
                date: "2025-10-05",
                heure: "15:00",
                places: 1,
                prix: 10,
                conducteur: "Amine Trabelsi",
                telephone: "98765432",
                statut: "terminee"
            }
        ];

        // Afficher les trajets publi√©s
        function displayTrajetsPublies() {
            const container = document.getElementById('trajetsPublies');
            
            const trajetsActifs = trajetsPublies.filter(t => t.statut === 'actif');
            
            if (trajetsActifs.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üöó</div>
                        <h3>Aucun trajet publi√©</h3>
                        <p>Commencez √† partager vos trajets avec la communaut√©</p>
                        <a href="publier.html">
                            <button class="btn btn-primary">Publier un trajet</button>
                        </a>
                    </div>
                `;
                return;
            }

            container.innerHTML = '';
            trajetsActifs.forEach(trajet => {
                const placesReservees = trajet.placesInitiales - trajet.places;
                const badge = trajet.places > 2 ? 'badge-success' : trajet.places > 0 ? 'badge-warning' : 'badge-secondary';
                const badgeText = trajet.places > 2 ? 'Disponible' : trajet.places > 0 ? 'Places limit√©es' : 'Complet';

                let reservationsHTML = '';
                if (trajet.reservations.length > 0) {
                    reservationsHTML = `
                        <div class="reservations-list">
                            <strong style="color: #333; margin-bottom: 0.5rem; display: block;">
                                üìã R√©servations (${trajet.reservations.length})
                            </strong>
                            ${trajet.reservations.map(res => `
                                <div class="reservation-item">
                                    <div class="reservation-info">
                                        <span>üë§ ${res.nom}</span>
                                        <span>üë• ${res.places} place(s)</span>
                                        <span>üìû ${res.telephone}</span>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    `;
                }

                const card = `
                    <div class="trajet-card">
                        <div class="trajet-header">
                            <span class="badge ${badge}">${badgeText}</span>
                            <span class="badge badge-info">${placesReservees}/${trajet.placesInitiales} r√©serv√©es</span>
                        </div>
                        <div class="trajet-route">
                            <span class="location">${trajet.depart}</span>
                            <span class="arrow">‚Üí</span>
                            <span class="location">${trajet.arrivee}</span>
                        </div>
                        <div class="trajet-details">
                            <div class="detail-item">
                                <span class="icon">üìÖ</span>
                                <span>${trajet.date}</span>
                            </div>
                            <div class="detail-item">
                                <span class="icon">üïê</span>
                                <span>${trajet.heure}</span>
                            </div>
                            <div class="detail-item">
                                <span class="icon">üë•</span>
                                <span>${trajet.places} places restantes</span>
                            </div>
                            <div class="detail-item">
                                <span class="icon">üí∞</span>
                                <span>${trajet.prix}DT / pers</span>
                            </div>
                        </div>
                        ${reservationsHTML}
                        <div class="trajet-actions">
                            <button class="btn btn-secondary btn-small" onclick="modifierTrajet(${trajet.id})">
                                ‚úèÔ∏è Modifier
                            </button>
                            <button class="btn btn-danger btn-small" onclick="annulerTrajet(${trajet.id})">
                                üóëÔ∏è Supprimer
                            </button>
                        </div>
                    </div>
                `;
                container.innerHTML += card;
            });
        }

        // Afficher les r√©servations
        function displayReservations() {
            const container = document.getElementById('mesReservations');
            
            const reservationsActives = mesReservationsData.filter(r => r.statut === 'confirmee');
            
            if (reservationsActives.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìã</div>
                        <h3>Aucune r√©servation</h3>
                        <p>Trouvez des trajets et r√©servez votre place</p>
                        <a href="trajets.html">
                            <button class="btn btn-primary">Rechercher des trajets</button>
                        </a>
                    </div>
                `;
                return;
            }

            container.innerHTML = '';
            reservationsActives.forEach(reservation => {
                const card = `
                    <div class="trajet-card">
                        <div class="trajet-header">
                            <span class="badge badge-success">Confirm√©e</span>
                            <span>Conducteur: ${reservation.conducteur}</span>
                        </div>
                        <div class="trajet-route">
                            <span class="location">${reservation.depart}</span>
                            <span class="arrow">‚Üí</span>
                            <span class="location">${reservation.arrivee}</span>
                        </div>
                        <div class="trajet-details">
                            <div class="detail-item">
                                <span class="icon">üìÖ</span>
                                <span>${reservation.date}</span>
                            </div>
                            <div class="detail-item">
                                <span class="icon">üïê</span>
                                <span>${reservation.heure}</span>
                            </div>
                            <div class="detail-item">
                                <span class="icon">üë•</span>
                                <span>${reservation.places} place(s)</span>
                            </div>
                            <div class="detail-item">
                                <span class="icon">üí∞</span>
                                <span>${reservation.prix * reservation.places}DT total</span>
                            </div>
                            <div class="detail-item">
                                <span class="icon">üìû</span>
                                <span>${reservation.telephone}</span>
                            </div>
                        </div>
                        <div class="trajet-actions">
                            <button class="btn btn-secondary btn-small" onclick="contacterConducteur('${reservation.conducteur}', '${reservation.telephone}')">
                                üìû Contacter
                            </button>
                            <button class="btn btn-danger btn-small" onclick="annulerReservation(${reservation.id})">
                                ‚ùå Annuler ma r√©servation
                            </button>
                        </div>
                    </div>
                `;
                container.innerHTML += card;
            });
        }

        // Changer d'onglet
        function switchTab(tab) {
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');

            if (tab === 'publies') {
                document.getElementById('trajetsPublies').style.display = 'grid';
                document.getElementById('mesReservations').style.display = 'none';
            } else {
                document.getElementById('trajetsPublies').style.display = 'none';
                document.getElementById('mesReservations').style.display = 'grid';
            }
        }

        // Modifier un trajet
        function modifierTrajet(id) {
            alert(`Modification du trajet #${id} (fonctionnalit√© √† impl√©menter)`);
        }

        // Annuler un trajet
        function annulerTrajet(id) {
            if (confirm('√ätes-vous s√ªr de vouloir supprimer ce trajet d√©finitivement ? Les passagers seront notifi√©s.')) {
                fetch('supprimer_mon_trajet.php', {
                    method: 'POST',
                    body: new URLSearchParams({
                        action: 'supprimer_mon_trajet',
                        trajet_id: id
                    })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert('‚úÖ ' + data.message);
                        // Retirer le trajet de la liste locale
                        const index = trajetsPublies.findIndex(t => t.id === id);
                        if (index !== -1) {
                            trajetsPublies.splice(index, 1);
                            displayTrajetsPublies();
                        }
                    } else {
                        alert('‚ùå ' + data.message);
                    }
                })
                .catch(error => {
                    console.error('Erreur:', error);
                    alert('‚ùå Erreur lors de la suppression du trajet');
                });
            }
        }

        // Contacter le conducteur
        function contacterConducteur(nom, telephone) {
            alert(`Contacter ${nom}\nT√©l√©phone: ${telephone}`);
        }

        // Annuler une r√©servation
        function annulerReservation(id) {
            if (confirm('√ätes-vous s√ªr de vouloir annuler cette r√©servation ?')) {
                const index = mesReservationsData.findIndex(r => r.id === id);
                if (index !== -1) {
                    mesReservationsData[index].statut = 'annulee';
                    displayReservations();
                    alert('‚úÖ R√©servation annul√©e avec succ√®s');
                }
            }
        }

        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            displayTrajetsPublies();
            displayReservations();
        });
    </script>
</body>
</html>