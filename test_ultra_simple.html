<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Test Ultra Simple</title>
    <style>
        body { padding: 20px; font-family: Arial; }
        .card { border: 1px solid #ddd; padding: 15px; margin: 10px 0; }
        button { padding: 10px 20px; background: blue; color: white; border: none; cursor: pointer; }
    </style>
</head>
<body>
    <h1>Test Ultra Simple - R√©servation</h1>
    <div id="container"></div>

    <script>
        // EXACTEMENT comme dans index_one.html
        let allTrajets = [];

        // Fonction pour afficher
        function afficher() {
            console.log('üìç D√©but afficher(), allTrajets.length =', allTrajets.length);
            
            const container = document.getElementById('container');
            container.innerHTML = '';

            allTrajets.forEach(trajet => {
                const card = `
                    <div class="card">
                        <strong>${trajet.depart} ‚Üí ${trajet.arrivee}</strong><br>
                        Prix: ${trajet.prix} DT<br>
                        <button class="btn-reserver" data-id="${trajet.id}">R√©server ID=${trajet.id}</button>
                    </div>
                `;
                container.insertAdjacentHTML('beforeend', card);
            });

            // Attacher √©v√©nements
            console.log('üìç Attachement des √©v√©nements...');
            const buttons = document.querySelectorAll('.btn-reserver');
            console.log('üìç Nombre de boutons trouv√©s:', buttons.length);
            
            buttons.forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = this.getAttribute('data-id');
                    console.log('üéØ CLIC! ID from button:', id);
                    reserver(id);
                });
            });
            
            console.log('üìç Fin afficher()');
        }

        // Fonction r√©server
        function reserver(trajetId) {
            console.log('üîµ reserver() appel√© avec:', trajetId, 'type:', typeof trajetId);
            console.log('üîµ allTrajets:', allTrajets);
            console.log('üîµ allTrajets IDs:', allTrajets.map(t => t.id));
            
            const id = parseInt(trajetId);
            console.log('üîµ id apr√®s parseInt:', id, 'type:', typeof id);
            
            const trajet = allTrajets.find(t => {
                console.log('  Comparaison:', parseInt(t.id), '===', id, '?', parseInt(t.id) === id);
                return parseInt(t.id) === id;
            });
            
            if (!trajet) {
                alert('‚ùå TRAJET INTROUVABLE!\nID recherch√©: ' + id + '\nIDs disponibles: ' + allTrajets.map(t => t.id).join(', '));
                return;
            }
            
            alert('‚úÖ Trajet trouv√©: ' + trajet.depart + ' ‚Üí ' + trajet.arrivee);
        }

        // Charger les donn√©es
        function charger() {
            console.log('üîµ Chargement...');
            fetch('rechercher_trajets.php')
                .then(r => r.json())
                .then(data => {
                    console.log('üì• Donn√©es:', data);
                    if (data.success && data.trajets) {
                        allTrajets = data.trajets.map(t => ({
                            id: parseInt(t.id),
                            depart: t.lieu_depart,
                            arrivee: t.lieu_arrivee,
                            prix: parseFloat(t.prix)
                        }));
                        console.log('‚úÖ allTrajets charg√©:', allTrajets);
                        afficher();
                    }
                })
                .catch(err => console.error('‚ùå Erreur:', err));
        }

        // D√©marrage
        document.addEventListener('DOMContentLoaded', charger);
    </script>
</body>
</html>
