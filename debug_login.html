<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Test Login Direct</title>
    <style>
        body { font-family: Arial; padding: 20px; background: #f5f5f5; }
        .box { background: white; padding: 20px; margin: 10px 0; border-radius: 5px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        pre { background: #f4f4f4; padding: 10px; overflow-x: auto; border: 1px solid #ddd; }
        .error { color: red; }
        .success { color: green; }
    </style>
</head>
<body>
    <h1>üîç Test de Login Direct</h1>
    
    <div class="box">
        <h2>Test 1: Appel direct via fetch()</h2>
        <button onclick="testLogin()">Tester la connexion</button>
        <div id="result1"></div>
    </div>

    <div class="box">
        <h2>Test 2: V√©rification de login.php</h2>
        <iframe src="test_login.php" style="width: 100%; height: 400px; border: 1px solid #ddd;"></iframe>
    </div>

    <script>
        function testLogin() {
            const resultDiv = document.getElementById('result1');
            resultDiv.innerHTML = '<p>‚è≥ Connexion en cours...</p>';
            
            fetch('login.php', {
                method: 'POST',
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                body: 'email=test@test.com&password=test123&role=user'
            })
            .then(response => {
                console.log('Status:', response.status);
                console.log('Status Text:', response.statusText);
                console.log('Headers:', response.headers);
                
                resultDiv.innerHTML += '<p><strong>Status HTTP:</strong> ' + response.status + '</p>';
                
                return response.text();
            })
            .then(text => {
                console.log('Response Text:', text);
                
                resultDiv.innerHTML += '<p><strong>R√©ponse brute du serveur:</strong></p>';
                resultDiv.innerHTML += '<pre>' + text.replace(/</g, '&lt;').replace(/>/g, '&gt;') + '</pre>';
                
                try {
                    const json = JSON.parse(text);
                    resultDiv.innerHTML += '<p class="success"><strong>‚úÖ JSON Valide:</strong></p>';
                    resultDiv.innerHTML += '<pre>' + JSON.stringify(json, null, 2) + '</pre>';
                } catch(e) {
                    resultDiv.innerHTML += '<p class="error"><strong>‚ùå Erreur JSON:</strong> ' + e.message + '</p>';
                    
                    // Analyser pourquoi ce n'est pas du JSON
                    if (text.trim().startsWith('<!DOCTYPE') || text.trim().startsWith('<html')) {
                        resultDiv.innerHTML += '<p class="error">‚ö†Ô∏è Le serveur retourne du HTML au lieu de JSON!</p>';
                    } else if (text.trim() === '') {
                        resultDiv.innerHTML += '<p class="error">‚ö†Ô∏è Le serveur retourne une r√©ponse vide!</p>';
                    } else {
                        resultDiv.innerHTML += '<p class="error">‚ö†Ô∏è Le serveur retourne du texte invalide!</p>';
                    }
                }
            })
            .catch(error => {
                console.error('Fetch Error:', error);
                resultDiv.innerHTML += '<p class="error"><strong>‚ùå Erreur de connexion:</strong> ' + error.message + '</p>';
            });
        }
    </script>
</body>
</html>
